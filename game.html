<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Santa Run ‚Äî Jump the Sleeping Kids & Chimneys</title>
<style>
  /* Basic page */
  html,body { height:100%; margin:0; font-family: Arial, Helvetica, sans-serif; background:#87CEEB; }
  header { background:#0b3d91; color:white; padding:10px 16px; text-align:center; }
  .wrap { display:flex; gap:16px; padding:12px; align-items:center; justify-content:center; flex-wrap:wrap; }
  .panel { background:rgba(255,255,255,0.9); padding:10px 14px; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,0.15); }
  .small { font-size:14px; }
  #gameCanvas { background: linear-gradient(#b3e6ff, #87CEEB); display:block; margin:16px auto; border-radius:8px; box-shadow:0 8px 30px rgba(0,0,0,0.2); }
  .controls { text-align:center; margin-top:6px; }
  button { padding:8px 12px; border-radius:6px; border:0; background:#0b7dda; color:white; cursor:pointer; }
  button:active { transform:translateY(1px); }
  .status { display:flex; gap:12px; align-items:center; }
  .score { font-weight:700; font-size:18px; }
  footer { text-align:center; padding:12px 8px; color:#222; font-size:13px; }
  /* small mobile scaling */
  @media (max-width:520px){
    #gameCanvas { width: 320px; height: 160px; }
  }
</style>
</head>
<body>
<header>
  <h1 style="margin:0">Santa Run üéÖ ‚Äî Jump the sleeping kids & chimneys</h1>
</header>

<div class="wrap" style="justify-content:center">
  <canvas id="gameCanvas" width="760" height="200"></canvas>

  <div class="panel small" style="min-width:220px; max-width:320px;">
    <div style="margin-bottom:8px"><strong>How to play:</strong></div>
    <ul>
      <li>Press <strong>Space</strong> to make Santa jump.</li>
      <li>Avoid beds (short) and chimneys (tall). If Santa touches them -> game over.</li>
      <li>Obstacles speed up over time. Last as long as you can!</li>
    </ul>

    <div class="status" style="margin-top:8px">
      <div class="score">Time: <span id="timeDisplay">0.00</span>s</div>
      <div class="score">Best: <span id="bestDisplay">0.00</span>s</div>
    </div>

    <div class="controls" style="margin-top:10px">
      <button id="startBtn">Start / Restart</button>
      <button id="muteBtn">Mute</button>
    </div>

    <div style="margin-top:10px; font-size:13px; color:#444">
      <strong>Note:</strong> The game is saved locally in this browser.
    </div>
  </div>
</div>

<footer>Made with ‚ù§Ô∏è ‚Äî press Space to jump. Have fun!</footer>

<script>
/* Santa Run ‚Äî single-file game
   - Canvas-based
   - Space to jump
   - Obstacles spawn from right, varying height (bed = low, chimney = tall)
   - Speed increases over time
   - Timer + best time via localStorage
   - Every 10s: play jingle + "HO HO HO" + fireworks
   - On new high score: sleigh swoop celebration
*/

/* -----------------------
   Helper / config
   ----------------------- */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let W = canvas.width;
let H = canvas.height;

function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }

/* Game state */
let running = false;
let startTime = 0;
let elapsed = 0;
let speedBase = 200; // px/sec base obstacle speed
let speedMultiplier = 1; // increases over time
let obstacles = [];
let lastObstacleAt = 0;
let obstacleGap = 1000; // ms average gap; will randomize
let santa = null;
let gravity = 2000; // px/sec^2
let mute = false;
let best = parseFloat(localStorage.getItem('santaBest')) || 0;
document.getElementById('bestDisplay').innerText = best.toFixed(2);

/* For 10 second jingle */
let lastJingleSecond = -1;

/* For sleigh celebration control */
let justSetNewBest = false;
let sleighs = [];

/* -----------------------
   Entities
   ----------------------- */
function resetGame(){
  obstacles = [];
  lastObstacleAt = 0;
  startTime = performance.now();
  elapsed = 0;
  speedMultiplier = 1;
  lastJingleSecond = -1;
  justSetNewBest = false;
  sleighs = [];
  santa = {
    x: 80,
    y: H - 48 - 40, // baseline y (ground at H-40)
    w: 36,
    h: 48,
    vy: 0,
    grounded: true,
    jumpStrength: 650 // px/sec initial velocity
  };
}

/* Obstacle factory: bed (short) or chimney (tall) */
function spawnObstacle(){
  // randomize type
  const types = ['bed','chimney'];
  const type = Math.random() < 0.6 ? 'bed' : 'chimney'; // more beds
  let h;
  if (type === 'bed') {
    h = 28 + Math.random()*20; // short obstacle height
  } else {
    h = 60 + Math.random()*30; // tall chimney
  }
  const obs = {
    type,
    w: type === 'bed' ? 40 + Math.random()*20 : 30,
    h,
    x: W + 20,
    y: H - 40 - h, // ground at H-40
    passed: false
  };
  obstacles.push(obs);
}

/* -----------------------
   Input handling
   ----------------------- */
window.addEventListener('keydown', (e)=>{
  if (e.code === 'Space') {
    e.preventDefault();
    if (!running) {
      start();
      return;
    }
    doJump();
  }
});
window.addEventListener('touchstart', (e)=>{
  e.preventDefault();
  if (!running) start();
  doJump();
}, {passive:false});

/* -----------------------
   Audio: WebAudio jingle and beep
   ----------------------- */
const AudioCtx = window.AudioContext || window.webkitAudioContext;
let audioCtx = null;

function ensureAudio(){
  if (!audioCtx) {
    try { audioCtx = new AudioCtx(); } catch(e){ audioCtx = null; }
  }
}

/* Play a short jingle (chord/arpeggio) */
function playJingle(){
  if (mute) return;
  ensureAudio();
  if (!audioCtx) return;
  const now = audioCtx.currentTime;
  const osc1 = audioCtx.createOscillator();
  const osc2 = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc1.type = 'sine';
  osc2.type = 'sine';
  osc1.frequency.value = 880;
  osc2.frequency.value = 660;
  gain.gain.value = 0.0001;
  gain.gain.exponentialRampToValueAtTime(0.12, now+0.02);
  gain.gain.exponentialRampToValueAtTime(0.0001, now+0.45);
  osc1.connect(gain); osc2.connect(gain);
  gain.connect(audioCtx.destination);
  osc1.start(now); osc2.start(now);
  osc1.stop(now + 0.45); osc2.stop(now + 0.45);
}

/* Simple "ho ho ho" using SpeechSynthesis if available */
function sayHoHoHo(){
  if (mute) return;
  if ('speechSynthesis' in window){
    const u = new SpeechSynthesisUtterance('Ho Ho Ho!');
    u.lang = 'en-US';
    u.volume = 0.9;
    window.speechSynthesis.cancel(); // stop others
    window.speechSynthesis.speak(u);
  } else {
    // fallback beep
    ensureAudio();
    if (!audioCtx) return;
    const now = audioCtx.currentTime;
    const osc = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    osc.frequency.value = 420;
    g.gain.value = 0.0001;
    g.gain.exponentialRampToValueAtTime(0.12, now+0.01);
    g.gain.exponentialRampToValueAtTime(0.0001, now+0.25);
    osc.connect(g); g.connect(audioCtx.destination);
    osc.start(now); osc.stop(now+0.25);
  }
}

/* -----------------------
   Visual effects: fireworks, sleigh
   ----------------------- */
let fireworks = [];

function createFireworks(x,y){
  for (let i=0;i<24;i++){
    fireworks.push({
      x,y,
      vx:(Math.random()-0.5)*300,
      vy:(Math.random()-0.7)*300,
      life: 0,
      ttl: 1000 + Math.random()*800,
      color: ['#ffd700','#ff6b6b','#7afcff','#ff9dea','#b6ffb3'][Math.floor(Math.random()*5)]
    });
  }
}

function updateFireworks(dt){
  for (let i= fireworks.length-1;i>=0;i--){
    const p = fireworks[i];
    p.life += dt;
    if (p.life > p.ttl) { fireworks.splice(i,1); continue; }
    p.vy += 600 * (dt/1000); // gravity small
    p.x += p.vx * (dt/1000);
    p.y += p.vy * (dt/1000);
  }
}

function drawFireworks(ctx){
  fireworks.forEach(p=>{
    const lifeRatio = 1 - p.life / p.ttl;
    ctx.globalAlpha = lifeRatio;
    ctx.fillStyle = p.color;
    ctx.beginPath();
    ctx.arc(p.x, p.y, 2.5 + 2*lifeRatio, 0, Math.PI*2);
    ctx.fill();
    ctx.globalAlpha = 1;
  });
}

/* Sleighs array: each sleigh has x,y and vx and drawn */
function spawnSleigh(){
  sleighs.push({ x: W+50, y: 40 + Math.random()*40, vx: -600 - Math.random()*200, t:0 });
}

/* -----------------------
   Game loop & draw
   ----------------------- */
function start(){
  resetGame();
  running = true;
  startTime = performance.now();
  lastTick = performance.now();
  requestAnimationFrame(tick);
}

function stop(){
  running = false;
  // update best
  if (elapsed > best){
    best = elapsed;
    localStorage.setItem('santaBest', best.toFixed(2));
    document.getElementById('bestDisplay').innerText = best.toFixed(2);
    justSetNewBest = true;
    // spawn a sleigh celebration
    spawnSleigh();
  }
}

function doJump(){
  if (!santa) return;
  // can only jump if grounded or allow small coyote time
  if (santa.grounded || santa.vy > -80) {
    santa.vy = -santa.jumpStrength;
    santa.grounded = false;
  }
}

/* collision check rect-rect */
function rectsOverlap(a,b){
  return !(a.x + a.w < b.x || a.x > b.x + b.w || a.y + a.h < b.y || a.y > b.y + b.h);
}

/* Draw Santa (simple) */
function drawSanta(ctx,s){
  // body
  ctx.fillStyle = '#b30000';
  ctx.fillRect(s.x, s.y, s.w, s.h);
  // beard / face
  ctx.fillStyle = '#ffe0bd';
  ctx.fillRect(s.x+6, s.y+6, s.w-12, 16);
  // hat
  ctx.fillStyle = '#ff0000';
  ctx.fillRect(s.x+2, s.y-6, s.w-4, 8);
  ctx.fillStyle = '#fff';
  ctx.fillRect(s.x+4, s.y+2, s.w-8, 4);
  // boots
  ctx.fillStyle = '#222';
  ctx.fillRect(s.x, s.y + s.h - 8, s.w, 8);
}

/* Draw obstacle (bed or chimney) */
function drawObstacle(ctx, o){
  if (o.type === 'bed'){
    // bed base
    ctx.fillStyle = '#8b4513';
    ctx.fillRect(o.x, o.y + o.h - 8, o.w, 8);
    // mattress
    ctx.fillStyle = '#ffd1dc';
    ctx.fillRect(o.x, o.y, o.w, o.h - 8);
    // pillow
    ctx.fillStyle = '#fff';
    ctx.fillRect(o.x + 4, o.y - 6, o.w/2, 6);
  } else {
    // chimney: brick column
    ctx.fillStyle = '#7a2a2a';
    ctx.fillRect(o.x, o.y, o.w, o.h);
    // top cap
    ctx.fillStyle = '#333';
    ctx.fillRect(o.x - 6, o.y - 8, o.w + 12, 8);
  }
}

/* Draw ground */
function drawGround(ctx){
  ctx.fillStyle = '#2e8b57';
  ctx.fillRect(0, H-40, W, 40);
  // simple stripes
  ctx.fillStyle = 'rgba(255,255,255,0.03)';
  for (let i=0;i<20;i++){
    ctx.fillRect((i*30 + (elapsed*0.2|0))%W, H-40, 15, 40);
  }
}

/* main loop */
let lastTick = 0;
function tick(ts){
  if (!running) {
    // draw final frame if needed
    drawFrame(0);
    return;
  }
  const dt = ts - lastTick;
  lastTick = ts;
  update(dt);
  drawFrame(dt);
  requestAnimationFrame(tick);
}

function update(dt){
  // update elapsed
  elapsed = (performance.now() - startTime) / 1000;
  document.getElementById('timeDisplay').innerText = elapsed.toFixed(2);

  // speed multiplier slowly grows
  speedMultiplier = 1 + elapsed * 0.08; // 8% per second scaling; tweakable
  const speed = speedBase * speedMultiplier;

  // spawn obstacles periodically
  lastObstacleAt += dt;
  // compute a dynamic gap: as speed increases, gaps shorten
  const curGap = clamp(obstacleGap / speedMultiplier, 550, 1400) + (Math.random()-0.5)*250;
  if (lastObstacleAt > curGap){
    spawnObstacle();
    lastObstacleAt = 0;
  }

  // update obstacles
  for (let i=obstacles.length-1;i>=0;i--){
    const o = obstacles[i];
    o.x -= speed * (dt/1000);
    // remove off screen
    if (o.x + o.w < -20) obstacles.splice(i,1);
  }

  // update santa physics
  const s = santa;
  if (s){
    // integrate vy
    s.vy += gravity * (dt/1000);
    s.y += s.vy * (dt/1000);
    // ground check
    const groundY = H - 40 - s.h; // ground top - santa.h
    if (s.y > groundY){
      s.y = groundY;
      s.vy = 0;
      s.grounded = true;
    } else {
      s.grounded = false;
    }
  }

  // collisions
  for (let i=0;i<obstacles.length;i++){
    const o = obstacles[i];
    const a = { x: santa.x, y: santa.y, w: santa.w, h: santa.h };
    const b = { x: o.x, y: o.y, w: o.w, h: o.h };
    if (rectsOverlap(a,b)){
      // lose
      running = false;
      stop();
      break;
    }
  }

  // update fireworks
  updateFireworks(dt);

  // update sleighs
  for (let i=sleighs.length-1;i>=0;i--){
    const s = sleighs[i];
    s.x += s.vx * (dt/1000);
    s.t += dt;
    // simple particle sparks behind sleigh
    if (Math.random() < 0.3) {
      createFireworks(s.x + 10, s.y + 8);
    }
    if (s.x < -200) sleighs.splice(i,1);
  }

  // periodic jingle every 10 seconds if alive
  const sec10 = Math.floor(elapsed / 10);
  if (sec10 > 0 && sec10 !== lastJingleSecond){
    lastJingleSecond = sec10;
    // play jingle
    playJingle();
    // speech
    sayHoHoHo();
    // fireworks near santa
    createFireworks(santa.x + 20, santa.y - 10);
  }

  // If new high score just set, spawn occasional celebratory sparkles
  if (justSetNewBest && Math.random() < 0.05){
    createFireworks( Math.random()*(W-80)+40, 30 + Math.random()*60 );
  }

  // if elapsed passes new best during active gameplay (not yet ended), trigger celebration if surpass
  if (!justSetNewBest && elapsed > best && best > 0){
    // first time surpassing previous best while alive: spawn sleigh
    justSetNewBest = true;
    spawnSleigh();
  }
}

function drawFrame(dt){
  // clear
  ctx.clearRect(0,0,W,H);

  // sky gradient
  const g = ctx.createLinearGradient(0,0,0,H-40);
  g.addColorStop(0,'#bfe9ff');
  g.addColorStop(1,'#87CEEB');
  ctx.fillStyle = g;
  ctx.fillRect(0,0,W,H-40);

  // draw ground
  drawGround(ctx);

  // draw obstacles
  obstacles.forEach(o => drawObstacle(ctx, o));

  // draw santa
  drawSanta(ctx, santa);

  // draw fireworks
  drawFireworks(ctx);

  // draw sleighs (simple icon)
  sleighs.forEach(s=>{
    // body
    ctx.fillStyle = '#6b2f00';
    ctx.fillRect(s.x, s.y, 80, 22);
    // roof
    ctx.fillStyle = '#ffcc00';
    ctx.fillRect(s.x + 56, s.y - 6, 18, 6);
    // reindeer simple circles
    ctx.fillStyle = '#7d4b2e';
    for (let i=0;i<3;i++){
      ctx.beginPath();
      ctx.arc(s.x - 16 - i*26, s.y + 6, 8, 0, Math.PI*2);
      ctx.fill();
    }
  });

  // overlay status if stopped
  if (!running) {
    ctx.fillStyle = 'rgba(0,0,0,0.5)';
    ctx.fillRect(0,0,W,H);
    ctx.fillStyle = 'white';
    ctx.textAlign = 'center';
    ctx.font = 'bold 28px Arial';
    ctx.fillText('Game Over', W/2, H/2 - 10);
    ctx.font = '16px Arial';
    ctx.fillText('Press Start / Space to try again', W/2, H/2 + 18);
    // show final time
    ctx.font = 'bold 20px Arial';
    ctx.fillText('Time: ' + elapsed.toFixed(2) + ' s', W/2, H/2 + 48);
  }
}

/* -----------------------
   UI buttons
   ----------------------- */
document.getElementById('startBtn').addEventListener('click', ()=>{
  start();
});
document.getElementById('muteBtn').addEventListener('click', ()=>{
  mute = !mute;
  document.getElementById('muteBtn').innerText = mute ? 'Unmute' : 'Mute';
});

/* -----------------------
   Resize handling
   ----------------------- */
window.addEventListener('resize', ()=>{
  // keep canvas physical size consistent unless mobile small; we're using fixed canvas coords for simplicity
});

/* Initialize */
resetGame();
drawFrame(0);

/* Prevent page scroll on space when playing */
window.addEventListener('keydown', function(e){
  if (e.code === 'Space') e.preventDefault();
});
</script>
</body>
</html>
